(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["assistant"],{"01cd":function(e,t,n){"use strict";var s=n("f641"),a=n.n(s);a.a},"0659":function(e,t,n){},2532:function(e,t,n){"use strict";var s=n("23e7"),a=n("5a34"),i=n("1d80"),r=n("ab13");s({target:"String",proto:!0,forced:!r("includes")},{includes:function(e){return!!~String(i(this)).indexOf(a(e),arguments.length>1?arguments[1]:void 0)}})},2533:function(e,t,n){},"27eb":function(e,t,n){"use strict";var s=n("8600"),a=n.n(s);a.a},"2dc3":function(e,t,n){"use strict";var s=n("0659"),a=n.n(s);a.a},3247:function(e,t,n){"use strict";var s=n("2533"),a=n.n(s);a.a},3352:function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"bottom"},[e._v(" bottom ")])},a=[],i=n("d4ec"),r=n("99de"),o=n("7e84"),c=n("262e"),l=n("9ab4"),u=n("60a3"),d=function(e){function t(){return Object(i["a"])(this,t),Object(r["a"])(this,Object(o["a"])(t).apply(this,arguments))}return Object(c["a"])(t,e),t}(u["f"]);d=Object(l["a"])([u["a"]],d);var h=d,p=h,f=(n("783f"),n("2877")),v=Object(f["a"])(p,s,a,!1,null,"016a8239",null);t["a"]=v.exports},"5a34":function(e,t,n){var s=n("44e7");e.exports=function(e){if(s(e))throw TypeError("The method doesn't accept regular expressions");return e}},"5c67":function(e,t,n){"use strict";var s=n("f1e5"),a=n.n(s);a.a},"6eba":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Layout",[n("div",{style:{height:e.containerHeight+"px"},attrs:{id:"assistant"}},[e.loading?n("div",{staticClass:"loading"},[n("a-spin",{staticClass:"loading-spin",attrs:{tip:"正在初始化"}},[n("a-icon",{staticStyle:{"font-size":"24px"},attrs:{slot:"indicator",type:"loading",spin:""},slot:"indicator"})],1)],1):e._e(),n("div",{staticClass:"assistantContainer"},[n("div",{staticClass:"center column"},[n("div",{staticClass:"subjectInfo"},[n("div",{staticClass:"line1"},[e._v(e._s(e.planInfo.planName))]),n("div",{staticClass:"line2"},[n("div",{staticClass:"teacherImg"},[n("img",{attrs:{src:e.planInfo.banner,alt:"老师头像"}})]),n("div",{staticClass:"teacherName"},[e._v("主讲老师："+e._s(e.planInfo.speaker))]),n("div",{staticClass:"line"}),n("div",{staticClass:"subjectTime"},[e._v(e._s(e._f("speakTime")(e.planInfo.startTime))+"-"+e._s(e._f("speakTime")(e.planInfo.endTime)))])])]),n("div",{attrs:{id:"polyvLivePlayerContainer"}})]),n("div",{staticClass:"left column"},[n("div",{staticClass:"componentContainer"},[n("OnlineUser",{ref:"onlineUser",attrs:{onlineUserList:e.onlineUserList,bannedUserList:e.bannedUserList},on:{searchBannedUserList:e.handleSearchBannedUserList,bannedUser:e.handleBannedUser,selectStudent:e.handleSelectQuestion}})],1)]),n("div",{staticClass:"right column"},[n("div",{staticClass:"componentContainer"},[n("div",{staticClass:"chatRoomTopBar"},[n("div",{staticClass:"chatRoomTopBarLeft chatRoomTopBarTab",class:{selected:"barrage"===e.selectedTabName},on:{click:function(t){return e.handleSwitchTabbar("barrage")}}},[e._v("弹幕")]),n("div",{staticClass:"chatRoomTopBarRight chatRoomTopBarTab",class:{selected:"studentQuestion"===e.selectedTabName},on:{click:function(t){return e.handleSwitchTabbar("studentQuestion")}}},[e._v(" 提问 "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.hasNewQuestion,expression:"hasNewQuestion"}],staticClass:"redpoint"})])]),n("div",{staticClass:"chatRoomComponentConatiner"},[n("ChatRoom",{ref:"chatRoom",style:{"z-index":"barrage"===e.selectedTabName?"1":"-1"},attrs:{speakList:e.speakList},on:{bannedUser:e.handleBannedUser,delBarrage:e.handleDelBarrage}}),n("StudentQuestion",{ref:"studentQuestion",style:{"z-index":"studentQuestion"===e.selectedTabName?"1":"-1"},attrs:{studentQuestionList:e.studentQuestionList},on:{selectQuestion:e.handleSelectQuestion}})],1),n("MessageInput",{attrs:{teacherAnswerInfo:e.teacherAnswerInfo},on:{sendMessage:e.handleSendMessage,sendAnswer:e.handleSendAnswer}})],1)])])])])},a=[],i=(n("a9e3"),n("d4ec")),r=n("bee2"),o=n("99de"),c=n("7e84"),l=n("262e"),u=n("9ab4"),d=n("60a3"),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("top"),e._t("default")],2)},p=[],f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"top"},[n("div",{staticClass:"top-container"},[n("div",{staticClass:"logo",on:{click:e.logo}}),n("div",{staticClass:"subname"},[e._v("网校直播")]),n("div",{staticClass:"menu"},[n("div",{staticClass:"panel",on:{click:e.handleGoManage}},[n("span",{staticClass:"iconfont"},[e._v("")]),e._v("管理 ")]),n("div",{staticClass:"panel",on:{click:e.handleExit}},[n("span",{staticClass:"iconfont"},[e._v("")]),e._v("离开 ")])])])])},v=[],m=(n("ac1f"),n("5319"),n("083b")),b=n("2f62"),y=function(e){function t(){return Object(i["a"])(this,t),Object(o["a"])(this,Object(c["a"])(t).apply(this,arguments))}return Object(l["a"])(t,e),Object(r["a"])(t,[{key:"created",value:function(){this.$store.dispatch("admins")}},{key:"mounted",value:function(){var e=Object(m["b"])("token",!1);e||this.unLogin()}},{key:"unLogin",value:function(){this.$store.commit("setPaperEditDetailDataInit"),Object(m["a"])("token"),this.$router.push({path:"/login"})}},{key:"logo",value:function(){this.$router.push({path:"/"})}},{key:"handleExit",value:function(){console.log(1111),this.$router.back()}},{key:"handleGoManage",value:function(){console.log(1111),this.$router.replace({name:"manage",query:this.$route.query})}}]),t}(d["f"]);y=Object(u["a"])([Object(d["a"])({computed:Object(b["b"])(["userInfo","admins"]),components:{}})],y);var g=y,k=g,I=(n("3247"),n("2877")),S=Object(I["a"])(k,f,v,!1,null,"e99aecc0",null),C=S.exports,T=n("3352"),O=function(e){function t(){return Object(i["a"])(this,t),Object(o["a"])(this,Object(c["a"])(t).apply(this,arguments))}return Object(l["a"])(t,e),t}(d["f"]);O=Object(u["a"])([Object(d["a"])({components:{Top:C,Bottom:T["a"]}})],O);var _=O,j=_,L=(n("2dc3"),Object(I["a"])(j,h,p,!1,null,"99c243b4",null)),E=L.exports,w=(n("a4d3"),n("e01a"),n("d28b"),n("99af"),n("4de4"),n("c740"),n("4160"),n("c975"),n("a15b"),n("fb6a"),n("a434"),n("b0c0"),n("b64b"),n("d3b7"),n("25f0"),n("3ca3"),n("466d"),n("1276"),n("159b"),n("ddb0"),n("2909")),U=n("53ca"),N=n("6e7c"),A=n("c080"),B=n("efee"),x=n("5a0c"),P=n.n(x),R=n("ee50"),Q=n("2e1a"),$=n("4938"),M=n("8237"),D=n.n(M),H=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(o["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.loading=!0,e.subjectId=323,e.planId=1504,e.roomId=565988,e.onlineUserList=[],e.bannedUserList=[],e.onlineUserListPageCount=9999,e.onlineUserListPageNumber=1,e.speakList=[],e.studentQuestionList=[],e.studentInfoFindListCache={},e.polyvUserId=e.$store.state.userInfo.id+"_",e.userImg="http://livestatic.videocc.net/assets/wimages/missing_face.png",e.userType="SPEAKER"===e.$store.state.userInfo.role?"teacher":"assistant",e.teacherAnswerInfo={},e.planInfo={},e.liveSDK=null,e}return Object(l["a"])(t,e),Object(r["a"])(t,[{key:"mounted",value:function(){var e=this,t=function(){Object(A["g"])(e.roomId.toString(),e.polyvUserId,e.userType).then((function(t){e.initChatRoom(t.data.data)}))};if(console.log(void 0!==Object(U["a"])(this.$store.state.userInfo)),void 0!==Object(U["a"])(this.$store.state.userInfo)){if("HELPER"!==this.$store.state.userInfo.role)return void this.$message.error("你不是辅导老师！")}else this.$message.error("你还没有登录！"),this.$router.replace("./login");if("string"!==typeof this.$route.query.roomId&&"number"!==typeof this.$route.query.roomId||(this.roomId=Number(this.$route.query.roomId)),"string"!==typeof this.$route.query.planId&&"number"!==typeof this.$route.query.planId||(this.planId=Number(this.$route.query.planId)),"string"!==typeof this.$route.query.subjectId&&"number"!==typeof this.$route.query.subjectId||(this.subjectId=Number(this.$route.query.subjectId)),this.polyvUserId=this.$store.state.userInfo.id+"_"+this.subjectId,"undefined"===typeof PolyvChatRoom){var n=document.createElement("script");n.type="text/javascript",n.src=N["a"],document.getElementsByTagName("head")[0].appendChild(n),n.onload=t}else t();if("undefined"===typeof PolyvLiveSdk){var s=document.createElement("script");s.type="text/javascript",s.src=N["c"],document.getElementsByTagName("head")[0].appendChild(s)}console.log(this.onlineUser)}},{key:"initChatRoom",value:function(e){var t=this;this.startTimeStamp=(new Date).getTime(),this.polyvChatRoom=new PolyvChatRoom({roomId:this.roomId.toString(),userId:this.polyvUserId,pic:this.userImg,nick:this.$store.state.userInfo.name,userType:this.userType,token:e.token,mediaChannelKey:e.mediaChannelKey,version:"2.0",roomMessage:function(e){switch(console.log(e),e.EVENT){case"LOGIN":t.handleOnlineUserListChange(e);break;case"LOGOUT":t.handleOnlineUserListChange(e);break;case"TEACHER_INFO":break;case"O_TEACHER_INFO":break;case"SPEAK":t.handleChatSpeak(e);break;case"SEND_MESSAGE":break;case"KICK":break;case"ADD_SHIELD":t.handleShieldStatusChange(e);break;case"REMOVE_SHIELD":t.handleShieldStatusChange(e);break;case"S_QUESTION":t.handleStudentAskQuestion(e);break;case"T_ANSWER":t.handleStudentAskQuestion(e);break;case"REWARD":t.handleStudentReward(e);break;case"SELF_SPEAK":t.handleChatSpeak(e);break}}}),this.chat=this.polyvChatRoom.chat,this.chatSocket=this.chat.socket,Promise.all([this.getHistoryMessage(),this.handleGetOnlineUserList({onlineUserListPageNumber:this.onlineUserListPageNumber,onlineUserListPageCount:this.onlineUserListPageCount}),this.createJiahuiSocket(),this.getPlanDetailInfo(),this.initLivePlayer()]).then((function(e){t.getStudentAskQuestionHistory().then((function(){t.loading=!1}))})).catch((function(e){console.log(e),t.loading=!1,t.$message.error("初始化失败，请重试")}))}},{key:"initLivePlayer",value:function(){var e=this;return Object(A["c"])({channelId:this.roomId.toString(),appId:N["d"]}).then((function(t){e.liveSDK=new PolyvLiveSdk({channelId:e.roomId,appId:N["d"],sign:t.data.retval.sign,timestamp:t.data.retval.timestamp,socket:e.chatSocket,user:{userId:e.polyvUserId,userName:e.$store.state.userInfo.name,pic:e.userImg}});var n={el:"#polyvLivePlayerContainer",type:"live"};e.liveSDK.on(PolyvLiveSdk.EVENTS.CHANNEL_DATA_INIT,(function(t,s){console.log(t,s),e.liveSDK.setupPlayer(n)}))}))}},{key:"getPlanDetailInfo",value:function(){var e=this;return Object(A["b"])(this.planId).then((function(t){e.planInfo=t.data.retval}))}},{key:"getHistoryMessage",value:function(){var e=this;return Object(A["e"])(this.roomId.toString(),P()(this.planInfo.startTime).format("YYYY-MM-DD HH:mm:ss"),P()(this.startTimeStamp).format("YYYY-MM-DD HH:mm:ss")).then((function(t){for(var n=t.data.data,s=t.data.data.length-1;s>=0;s--)e.speakList.unshift({id:n[s].id,user:n[s].user,time:n[s].time,content:"string"===typeof n[s].content?e.replaceAllExpress(n[s].content):n[s].content,msgType:n[s].msgType})})).then((function(){e.chatRoom.scrollToBottom()}))}},{key:"handleChatSpeak",value:function(e){"SELF_SPEAK"===e.EVENT&&(e.content=e.values[0]),e.content=this.replaceAllExpress(e.content),this.speakList.push(e)}},{key:"replaceAllExpress",value:function(e){var t="";function n(e){var s=e.match(B["b"]);if(null!==s){var a=B["a"].indexOf(s[0]);t=-1!==a?t.concat(e.slice(0,s.index)+'<img class="express_img" src="'.concat(B["d"]+(a+1),'.png" alt="').concat("string"===typeof s[0]?"[".concat(s[0],"]"):"",'"/>')):t.concat(e.slice(0,s.index)+s[0]),n(e.slice(s[0].length+s.index))}else t=t.concat(e)}return n(e),t}},{key:"handleGetOnlineUserList",value:function(e){var t=this;this.chat.getUserList(e.onlineUserListPageNumber,e.onlineUserListPageCount).then((function(e){var n,s=[],a=[];e.userlist.forEach((function(e,t){"teacher"===e.userType&&a.push(t)})),s=e.userlist.filter((function(e,t){if(-1===a.indexOf(t))return e})),(n=t.onlineUserList).push.apply(n,Object(w["a"])(s))}))}},{key:"handleShieldStatusChange",value:function(e){if("userId"===e.data.banType){var t=this.onlineUserList.findIndex((function(t){return t.userId===e.data.userId}));-1!==t&&("ADD_SHIELD"===e.EVENT?this.onlineUserList[t].banned=!0:this.onlineUserList[t].banned=!1),"ADD_SHIELD"===e.EVENT?this.bannedUserList.push(this.onlineUserList[t].userId):this.bannedUserList.splice(t,1)}}},{key:"handleStudentAskQuestion",value:function(e){e.content=this.replaceAllExpress(e.content);var t=this.studentQuestionList.push(e);if("T_ANSWER"===e.EVENT&&(this.selectNeedInfoUserIdPushInCache(e,t-1),"string"===typeof e.s_userId&&""!==e.s_userId&&(this.findUserNameByUserIds([e.s_userId.split("_")[0]]),null!==this.teacherAnswerInfo&&void 0!==this.teacherAnswerInfo.messageData))){var n=JSON.parse(this.teacherAnswerInfo.messageData);e.user.userId===this.polyvUserId&&e.content===n.content&&e.s_userId===n.s_userId&&this.$set(this.studentQuestionList[t-1],"studentContent",this.teacherAnswerInfo.content)}}},{key:"getStudentAskQuestionHistory",value:function(){var e=this;return Object(A["f"])(this.roomId.toString()).then((function(t){for(var n=t.data.data,s=0;s<=n.length-1;s++)e.studentQuestionList.unshift({id:n[s].id,user:n[s].user,time:n[s].time,content:e.replaceAllExpress(n[s].content),s_userId:n[s].s_userId,EVENT:n[s].event});for(var a=0;a<=e.studentQuestionList.length-1;a++)e.selectNeedInfoUserIdPushInCache(e.studentQuestionList[a],a);console.log(e.studentInfoFindListCache);var i=Object.keys(e.studentInfoFindListCache);i.length>0&&e.findUserNameByUserIds(i)})).then((function(){e.studentQuestion.scrollToBottom()}))}},{key:"selectNeedInfoUserIdPushInCache",value:function(e,t){if("T_ANSWER"===e.EVENT&&"string"===typeof e.s_userId&&""!==e.s_userId){var n=e.s_userId.split("_")[0];this.studentInfoFindListCache.hasOwnProperty(n)?this.studentInfoFindListCache[n].idxs.push(t):this.studentInfoFindListCache[n]={idxs:[t],name:Q["b"],mobile:"",s_userid:e.s_userId}}}},{key:"findUserNameByUserIds",value:function(e){var t=this,n=e.join(",");this.checkJiahuiSocketIsReady(this.jiahuiSocket).then((function(e){t.jiahuiSocket.send(JSON.stringify({userId:t.$store.state.userInfo.id,messageType:"select",ids:n,token:Object(R["b"])()}))})).catch((function(e){}))}},{key:"handleSelectQuestion",value:function(e){"S_QUESTION"!==e.event&&"S_QUESTION"!==e.EVENT||(console.log("handleSelectQuestion",e),this.teacherAnswerInfo={user:e.user,content:e.content})}},{key:"handleSendAnswer",value:function(e){var t=JSON.stringify({EVENT:"T_ANSWER",roomId:this.roomId,user:{userId:this.polyvUserId,pic:this.userImg,nick:this.$store.state.userInfo.name,userType:this.userType,actor:"teacher"===this.userType?"讲师":"助教"},s_userId:e.s_userId,content:e.content});this.chatSocket.emit("message",t),this.teacherAnswerInfo.messageData=t}},{key:"createJiahuiSocket",value:function(){var e=this;return new Promise((function(t,n){clearTimeout(e.reLinkTimer),e.jiahuiSocket=Object(A["h"])(e.$store.state.userInfo.id.toString(),e.planId.toString()),console.log(e.jiahuiSocket),e.jiahuiSocket.onopen=function(e){t(e)},e.jiahuiSocket.onerror=function(t){e.jiahuiSocket.close(),console.log("error",t,e.jiahuiSocket),n(t)},e.jiahuiSocket.onclose=function(t){console.log("closed",t,e.jiahuiSocket),e.reLinkTimer=setTimeout((function(){e.createJiahuiSocket()}),1e3*$["a"]),n(t)},e.jiahuiSocket.onmessage=function(t){e.handleJiahuiSocketOnMessage(t)}}))}},{key:"handleJiahuiSocketOnMessage",value:function(e){var t;console.log(JSON.parse(e.data));try{t=JSON.parse(e.data)}catch(e){console.log(e)}if(console.log(t),"0"===t.code)switch(t.event){case"select_member":this.handleSelectMemberOver(t);break}else console.log("scoketResponseErr:",t)}},{key:"handleSelectMemberOver",value:function(e){console.log(e);var t=!0,n=!1,s=void 0;try{for(var a,i=e.data[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var r=a.value;this.studentInfoFindListCache.hasOwnProperty(r.id)&&(this.studentInfoFindListCache[r.id].mobile=r.mobile,this.studentInfoFindListCache[r.id].name=r.name)}}catch(g){n=!0,s=g}finally{try{t||null==i.return||i.return()}finally{if(n)throw s}}var o=[];for(var c in this.studentInfoFindListCache)if(this.studentInfoFindListCache.hasOwnProperty(c)){var l=this.studentInfoFindListCache[c].name;if(l!==Q["b"]&&""!==l){var u=!0,d=!1,h=void 0;try{for(var p,f=this.studentInfoFindListCache[c].idxs[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var v=p.value;this.$set(this.studentQuestionList[v],"studentName",l)}}catch(g){d=!0,h=g}finally{try{u||null==f.return||f.return()}finally{if(d)throw h}}}o.push(c)}for(var m=0,b=o;m<b.length;m++){var y=b[m];this.studentInfoFindListCache[y].idxs=[]}}},{key:"checkJiahuiSocketIsReady",value:function(e){return new Promise((function(t,n){switch(e.readyState){case 0:n("connecting");case 1:t("open");case 2:n("closing");case 3:n("closed")}}))}},{key:"handleStudentReward",value:function(e){e.user=e.content.rewardUser,e.msgType="reward",this.speakList.push(e)}},{key:"handleSearchBannedUserList",value:function(){var e=this;Object(A["d"])(this.roomId.toString()).then((function(t){e.bannedUserList=t.data.data}))}},{key:"handleOnlineUserListChange",value:function(e){if("LOGIN"===e.EVENT){var t=this.onlineUserList.findIndex((function(t){return t.userId===e.user.userId}));-1===t&&"teacher"!==e.user.userType&&this.onlineUserList.push(e.user)}else if("LOGOUT"===e.EVENT){var n=this.onlineUserList.findIndex((function(t){return t.userId===e.userId}));-1!==n&&"teacher"!==e.user.userType&&this.onlineUserList.splice(n,1)}}},{key:"handleBannedUser",value:function(e){var t={EVENT:"ban"===e.type?"SHIELD":"REMOVE_SHIELD",roomId:this.roomId,channelId:this.roomId,type:"userId",value:e.userId,sign:D()("polyv_room_sign"+this.roomId)};this.chatSocket.emit("message",JSON.stringify(t))}},{key:"handleSendMessage",value:function(e){if("string"===typeof e&&""!==e){var t=JSON.stringify({EVENT:"SPEAK",values:[e],roomId:this.roomId});this.chatSocket.emit("message",t),this.speakList.push({content:e,id:Math.random().toString(36).substring(2),time:(new Date).getTime(),msgType:"",user:{userId:this.polyvUserId,pic:this.userImg,nick:this.$store.state.userInfo.name,userType:this.userType}})}}},{key:"handleDelBarrage",value:function(e){var t=this;Object(A["a"])(this.roomId.toString(),e).then((function(e){200===e.data.code&&t.$message.success("操作成功")}))}},{key:"destroyed",value:function(){this.destroyAll()}},{key:"beforeRouteLeave",value:function(e,t,n){this.destroyAll(),n()}},{key:"destroyAll",value:function(){clearTimeout(this.reLinkTimer),clearTimeout(this.onlineUserListReloadTimer),this.chatSocket.close(),this.jiahuiSocket.close(),this.liveSDK.destroy(!0),this.liveSDK=null}}]),t}(d["f"]);Object(u["a"])([Object(d["e"])()],H.prototype,"chatRoom",void 0),Object(u["a"])([Object(d["e"])()],H.prototype,"onlineUser",void 0),Object(u["a"])([Object(d["e"])()],H.prototype,"studentQuestion",void 0),H=Object(u["a"])([d["a"]],H);var V=H,F=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"chatRoom"}},[n("div",{attrs:{id:"chatRoomContainer"}},[e._l(e.speakList,(function(t){return n("div",{key:t.id,staticClass:"speakChunk"},[void 0===t.msgType||null===t.msgType||""===t.msgType?[n("div",{staticClass:"speakChunkLeft"},[n("div",{staticClass:"userImg"},[n("img",{attrs:{src:t.user.pic,alt:t.user.nick}})])]),n("div",{staticClass:"speakChunkRight"},[n("div",{staticClass:"speakChunkRightTop"},[n("div",{staticClass:"userNick"},[e._v(e._s(t.user.userId===e.myUserId||"SELF_SPEAK"===t.EVENT||"SELF_SPEAK"===t.event?"我":t.user.nick))]),""!==e.chatRoomGlobalUserType(t.user.userType)?n("div",{staticClass:"userTypeFlag"},[e._v(e._s(e.chatRoomGlobalUserType(t.user.userType)))]):e._e(),n("div",{staticClass:"speakTime"},[e._v(e._s(e._f("speakTime")(t.time)))])]),n("div",{staticClass:"speakChunkRightBottom"},[n("span",{staticClass:"speakContent",class:{itsme:t.user.userId===e.myUserId||"SELF_SPEAK"===t.EVENT||"SELF_SPEAK"===t.event},domProps:{innerHTML:e._s(t.content)},on:{click:function(n){return e.handleContentClick(n,t)}}})])])]:e._e(),"reward"===t.msgType?n("div",{staticClass:"gift"},[n("div",{staticClass:"userImg"},[n("img",{attrs:{src:t.user.pic,alt:t.user.nick}})]),n("div",{staticClass:"userNick"},[e._v(e._s(t.user.nick))]),n("span",{staticClass:"speakContent"},[e._v("送给老师"+e._s(t.content.goodNum)+"个"+e._s(t.content.rewardContent))])]):e._e()],2)})),n("div",{directives:[{name:"show",rawName:"v-show",value:e.banBarrageShow,expression:"banBarrageShow"}],staticClass:"banBarrageContainer",style:{top:e.banBarrageTop+"px"}},[n("span",{staticClass:"banActionBtn",on:{click:function(t){return e.handleBanBarrage("del")}}},[e._v("屏蔽本条弹幕")]),n("span",{staticClass:"banActionBtn",on:{click:function(t){return e.handleBanBarrage("delAndBan")}}},[e._v("屏蔽并禁言")]),n("span",{staticClass:"banBarrageExit iconfont",on:{click:e.handleCancelBanBarrage}},[e._v("")])])],2)])},K=[],G=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(o["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.myUserId=e.$store.state.userInfo.id+"_",e.banBarrageTop=0,e.banBarrageShow=!1,e.selectedBarrage={},e}return Object(l["a"])(t,e),Object(r["a"])(t,[{key:"mounted",value:function(){"string"!==typeof this.$route.query.subjectId&&"number"!==typeof this.$route.query.subjectId||(this.myUserId=this.$store.state.userInfo.id+"_"+this.$route.query.subjectId)}},{key:"handleNewSpeak",value:function(){var e=this;this.$nextTick((function(){e.scrollToBottom()}))}},{key:"chatRoomGlobalUserType",value:function(e){return"string"===typeof N["b"][e]?N["b"][e]:""}},{key:"scrollToBottom",value:function(){var e=document.getElementById("chatRoomContainer");e.scrollTop=e.scrollHeight}},{key:"handleContentClick",value:function(e,t){"teacher"!==t.user.userType&&"assistant"!==t.user.userType&&(this.banBarrageTop=e.target.offsetTop+e.target.clientHeight,this.banBarrageShow=!0,this.selectedBarrage=t)}},{key:"handleCancelBanBarrage",value:function(){this.selectedBarrage={},this.banBarrageShow=!1}},{key:"handleBanBarrage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"del";"delAndBan"===e&&void 0!==this.selectedBarrage.user&&this.handleBannedUser(this.selectedBarrage.user.userId),this.handleDelBarrage(this.selectedBarrage.id),this.selectedBarrage={},this.banBarrageShow=!1}},{key:"handleDelBarrage",value:function(e){return e}},{key:"handleBannedUser",value:function(e){return{type:"ban",userId:e}}}]),t}(d["f"]);Object(u["a"])([Object(d["d"])({default:[]})],G.prototype,"speakList",void 0),Object(u["a"])([Object(d["g"])("speakList")],G.prototype,"handleNewSpeak",null),Object(u["a"])([Object(d["b"])("delBarrage")],G.prototype,"handleDelBarrage",null),Object(u["a"])([Object(d["b"])("bannedUser")],G.prototype,"handleBannedUser",null),G=Object(u["a"])([Object(d["a"])({filters:{speakTime:function(e){return void 0===e?P()((new Date).getTime()).format("HH:mm"):P()(Number(e)).format("HH:mm")}}})],G);var J=G,q=J,W=(n("fe7c"),Object(I["a"])(q,F,K,!1,null,"7e404d8b",null)),Y=W.exports,z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"onlineUser"}},[s("div",{staticClass:"title"},[e._v("当前在线("+e._s(e.onlineUserList.length)+")")]),s("div",{staticClass:"onlineUserContainer"},[s("div",{staticClass:"searchInput"},[s("a-input",{attrs:{type:"text",placeholder:"输入学员姓名",allowClear:"",disabled:!e.canSearch},on:{change:e.handleSearchInputChange},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}),s("span",{staticClass:"searchBtn iconfont",on:{click:e.handleSearchStudent}},[e._v("")])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isSearch,expression:"!isSearch"}],staticClass:"listTypeSwitch"},[s("span",{staticClass:"listTypeSwitchChunk",class:{selected:"all"===e.switchType},on:{click:function(t){return e.handleSwitchListType("all")}}},[e._v("全 部")]),s("span",{staticClass:"listTypeSwitchChunk",class:{selected:"banned"===e.switchType},on:{click:function(t){return e.handleSwitchListType("banned")}}},[e._v("已禁言")])]),s("div",{staticClass:"onlineUserList"},[e._l(e.onlineUserIsShowList,(function(t){return["teacher"!==t.userType?s("div",{key:t.userid,staticClass:"onlineUserChunk"},[s("div",{staticClass:"left"},[s("div",{staticClass:"userHead",class:{isStudent:"teacher"!==t.userType&&"assistant"!==t.userType},on:{click:function(n){return e.handleAnswerStudent(t)}}},[s("div",{staticClass:"userImg"},[s("img",{attrs:{src:t.pic,alt:t.nick}})]),t.banned?s("img",{staticClass:"isbanned",attrs:{src:n("90df"),alt:"禁言中"}}):e._e()]),s("div",{staticClass:"userName"},[e._v(e._s(t.nick))]),""!==e.chatRoomGlobalUserType(t.userType)?s("div",{staticClass:"userTypeFlag"},[e._v(e._s(e.chatRoomGlobalUserType(t.userType)))]):e._e()]),s("div",{staticClass:"right"},["teacher"!==t.userType&&"assistant"!==t.userType?[t.banned?e._e():s("div",{staticClass:"banUserBtn banUser iconfont",on:{click:function(n){return e.handleBannedUser("ban",t.userId)}}},[e._v(" 禁 言")]),t.banned?s("div",{staticClass:"banUserBtn freeUser",on:{click:function(n){return e.handleBannedUser("free",t.userId)}}},[e._v("解除禁言")]):e._e()]:e._e()],2)]):e._e()]}))],2)])])},X=[],Z=(n("caad"),n("2532"),function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(o["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.onlineUserIsShowList=[],e.relBannedUserList=[],e.switchType="all",e.searchValue="",e.isSearch=!1,e.canSearch=!0,e}return Object(l["a"])(t,e),Object(r["a"])(t,[{key:"mounted",value:function(){this.onlineUserIsShowList=this.onlineUserList}},{key:"handleSearchStudent",value:function(){var e=this;this.canSearch&&"string"===typeof this.searchValue&&""!==this.searchValue&&(this.canSearch=!1,this.isSearch=!0,this.onlineUserIsShowList=this.onlineUserList.filter((function(t){return t.nick.includes(e.searchValue)})),this.canSearch=!0)}},{key:"handleSearchInputChange",value:function(){"string"===typeof this.searchValue&&""===this.searchValue&&(this.isSearch=!1,this.onlineUserIsShowList=this.onlineUserList)}},{key:"chatRoomGlobalUserType",value:function(e){return"string"===typeof N["b"][e]?N["b"][e]:""}},{key:"handleSwitchListType",value:function(e){this.canSearch&&(this.switchType=e,"banned"===e?(this.emitSearchBannedUserList(),this.onlineUserIsShowList=this.relBannedUserList):(this.onlineUserIsShowList=this.onlineUserList,this.isSearch=!1,this.canSearch=!0))}},{key:"handleBannedUserListChange",value:function(){var e=this;this.relBannedUserList=this.onlineUserList.filter((function(t){return-1!==e.bannedUserList.indexOf(t.userId)})),"banned"===this.switchType&&(this.onlineUserIsShowList=this.relBannedUserList)}},{key:"emitSearchBannedUserList",value:function(){}},{key:"handleBannedUser",value:function(e,t){return{type:e,userId:t}}},{key:"scrollToTop",value:function(){var e=document.getElementById("onlineUser");e.scrollTop=0}},{key:"handleAnswerStudent",value:function(e){if("teacher"!==e.userType&&"assistant"!==e.userType)return{EVENT:"S_QUESTION",user:e,content:null}}}]),t}(d["f"]));Object(u["a"])([Object(d["d"])({default:[]})],Z.prototype,"onlineUserList",void 0),Object(u["a"])([Object(d["d"])({default:[]})],Z.prototype,"bannedUserList",void 0),Object(u["a"])([Object(d["g"])("bannedUserList")],Z.prototype,"handleBannedUserListChange",null),Object(u["a"])([Object(d["b"])("searchBannedUserList")],Z.prototype,"emitSearchBannedUserList",null),Object(u["a"])([Object(d["b"])("bannedUser")],Z.prototype,"handleBannedUser",null),Object(u["a"])([Object(d["b"])("selectStudent")],Z.prototype,"handleAnswerStudent",null),Z=Object(u["a"])([d["a"]],Z);var ee=Z,te=ee,ne=(n("5c67"),Object(I["a"])(te,z,X,!1,null,"120a223f",null)),se=ne.exports,ae=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"studentQuestion"}},[n("div",{staticClass:"studentQuestionTips"},[e._v("提示：提问内容仅提问者和老师可见")]),n("div",{attrs:{id:"studentQuestionContainer"}},e._l(e.studentQuestionList,(function(t,s){return n("div",{key:t.id,staticClass:"speakChunk",class:{student:"S_QUESTION"===t.event||"S_QUESTION"===t.EVENT}},[void 0===t.msgType||null===t.msgType||""===t.msgType?[n("div",{staticClass:"speakChunkLeft"},[n("div",{staticClass:"userImg",on:{click:function(t){return t.stopPropagation(),e.handleSelectQuestion(s)}}},[n("img",{attrs:{src:t.user.pic,alt:t.user.nick}})])]),n("div",{staticClass:"speakChunkRight"},[n("div",{staticClass:"speakChunkRightTop"},[n("div",{staticClass:"userNick",on:{click:function(t){return t.stopPropagation(),e.handleSelectQuestion(s)}}},[e._v(e._s(t.user.nick))]),""!==e.chatRoomGlobalUserType(t.user.userType)?n("div",{staticClass:"userTypeFlag"},[e._v(e._s(e.chatRoomGlobalUserType(t.user.userType)))]):e._e(),n("div",{staticClass:"speakTime"},[e._v(e._s(e._f("speakTime")(t.time)))])]),n("div",{staticClass:"speakChunkRightBottom"},[n("span",{staticClass:"speakContent",class:{isTeacher:"teacher"===t.user.userType||"assistant"===t.user.userType},on:{click:function(t){return t.stopPropagation(),e.handleSelectQuestion(s)}}},["string"!==typeof t.studentContent?n("span",{staticClass:"targetName"},[e._v(e._s(e.showAnswerStudentName(t)))]):e._e(),"string"===typeof t.studentContent?n("div",{staticClass:"targetDetail"},[e._v(e._s(e.getStudentName(t)+"："+t.studentContent))]):e._e(),n("span",{staticClass:"contentDetail",domProps:{innerHTML:e._s(t.content)}})])])])]:e._e()],2)})),0)])},ie=[],re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"expressPanel"}},[n("div",{staticClass:"toolMenuBtn",on:{click:function(t){return t.stopPropagation(),e.handleshowMainPanel(t)}}},[e._t("default")],2),n("div",{directives:[{name:"show",rawName:"v-show",value:e.mainPanelShow,expression:"mainPanelShow"}],staticClass:"expressMainPanel",on:{click:function(e){e.stopPropagation()}}},e._l(e.expressList,(function(t,s){return n("span",{key:s,staticClass:"expressChunk",style:{"background-image":"url("+e.polyvExporessAllPath+")","background-position":"-"+24*s+"px 0"},on:{click:function(n){return e.handleSelectExpress(t)}}})})),0)])},oe=[],ce=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(o["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.expressList=B["a"],e.polyvExporessAllPath=B["c"],e.mainPanelShow=!1,e}return Object(l["a"])(t,e),Object(r["a"])(t,[{key:"mounted",value:function(){}},{key:"handleshowMainPanel",value:function(){this.mainPanelShow=!this.mainPanelShow,!0===this.mainPanelShow?document.addEventListener("click",this.handleshowMainPanel):document.removeEventListener("click",this.handleshowMainPanel)}},{key:"handleSelectExpress",value:function(e){return e}}]),t}(d["f"]);Object(u["a"])([Object(d["b"])("selectExpress")],ce.prototype,"handleSelectExpress",null),ce=Object(u["a"])([d["a"]],ce);var le=ce,ue=le,de=(n("b772"),Object(I["a"])(ue,re,oe,!1,null,"24e9cc11",null)),he=de.exports,pe=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(o["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.inputContent="",e.inputMaxLength=Q["c"],e}return Object(l["a"])(t,e),Object(r["a"])(t,[{key:"chatRoomGlobalUserType",value:function(e){return"string"===typeof N["b"][e]?N["b"][e]:""}},{key:"getStudentName",value:function(e){return"string"===typeof e.studentName&&""!==e.studentName?e.studentName:Q["b"]}},{key:"showAnswerStudentName",value:function(e){return"T_ANSWER"!==e.event&&"T_ANSWER"!==e.EVENT||"string"!==typeof e.s_userId||""===e.s_userId?"":"string"===typeof e.studentName&&""!==e.studentName?"回复"+e.studentName+"：":"回复"+Q["b"]+"："}},{key:"scrollToBottom",value:function(){var e=document.getElementById("studentQuestionContainer");e.scrollTop=e.scrollHeight}},{key:"handleSelectQuestion",value:function(e){return this.studentQuestionList[e]}}]),t}(d["f"]);Object(u["a"])([Object(d["d"])({default:[]})],pe.prototype,"studentQuestionList",void 0),Object(u["a"])([Object(d["g"])("studentQuestionList")],pe.prototype,"scrollToBottom",null),Object(u["a"])([Object(d["b"])("selectQuestion")],pe.prototype,"handleSelectQuestion",null),pe=Object(u["a"])([Object(d["a"])({components:{ExpressPanel:he},filters:{speakTime:function(e){return void 0===e?P()((new Date).getTime()).format("HH:mm"):P()(Number(e)).format("HH:mm")}}})],pe);var fe=pe,ve=fe,me=(n("27eb"),Object(I["a"])(ve,ae,ie,!1,null,"0fcc6cae",null)),be=me.exports,ye=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"messageInput"}},[void 0!==e.teacherAnswerInfo.user?[n("div",{directives:[{name:"show",rawName:"v-show",value:"T_ANSWER"===e.mode,expression:"mode === 'T_ANSWER'"}],staticClass:"teacherAnswerQuestionInfo"},["string"===typeof e.teacherAnswerInfo.content?n("span",{staticClass:"teacherAnswerQuestionInfoDetail"},[e._v(e._s(e.teacherAnswerInfo.user.nick+"：")+" "),n("span",{domProps:{innerHTML:e._s(e.teacherAnswerInfo.content)}})]):n("span",{staticClass:"teacherAnswerQuestionInfoDetail"},[e._v("回复："+e._s(e.teacherAnswerInfo.user.nick))]),n("span",{staticClass:"iconfont cancel",on:{click:e.handleCancelAnswer}},[e._v("")])])]:e._e(),n("div",{staticClass:"speakInputContainer"},[n("div",{staticClass:"inputToolBar"},[n("ExpressPanel",{on:{selectExpress:e.handleSelectExpress}},[n("span",{staticClass:"expressBtn iconfont"},[e._v("")])])],1),n("div",{staticClass:"inputArea"},[n("a-input",{staticClass:"inputTextArea",attrs:{type:"textarea",maxlength:"SPEAK"===e.mode?e.barrageInputMaxLength:e.answerInputMaxLength,placeholder:"请输入文字"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSendMessage(t)}},model:{value:e.inputContent,callback:function(t){e.inputContent=t},expression:"inputContent"}})],1),n("div",{staticClass:"inputAreaBottom"},[n("div",{staticClass:"messageLengthTips"},[e._v(e._s(e.inputContent.length)+"/"+e._s("T_ANSWER"===e.mode?e.answerInputMaxLength:e.barrageInputMaxLength))]),n("button",{staticClass:"messageSubmitBtn",class:{disabled:e.inputContent.length<=0},on:{click:e.handleSendMessage}},[e._v("发 送")])])])],2)},ge=[],ke=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(o["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.mode="SPEAK",e.inputContent="",e.barrageInputMaxLength=Q["c"],e.answerInputMaxLength=Q["a"],e}return Object(l["a"])(t,e),Object(r["a"])(t,[{key:"handleTeacherAnswerInfoChange",value:function(){this.mode="T_ANSWER"}},{key:"handleCancelAnswer",value:function(){this.mode="SPEAK"}},{key:"handleSelectExpress",value:function(e){this.inputContent.length+e.length<=("SPEAK"===this.mode?Q["c"]:Q["a"])?this.inputContent+=e:this.$message.error("超出规定字数啦")}},{key:"handleSendMessage",value:function(){this.inputContent.length>0&&("SPEAK"===this.mode&&this.emitMessage(),"T_ANSWER"===this.mode&&this.sendAnswer())}},{key:"emitMessage",value:function(){if(this.inputContent.length<Q["c"]){var e=this.inputContent;return this.inputContent="",e}this.$message.error("超出规定字数啦")}},{key:"sendAnswer",value:function(){if(this.inputContent.length<Q["a"]){var e=this.inputContent;return this.inputContent="",{s_userId:this.teacherAnswerInfo.user.userId,content:e}}this.$message.error("超出规定字数啦")}}]),t}(d["f"]);Object(u["a"])([Object(d["d"])({default:{}})],ke.prototype,"teacherAnswerInfo",void 0),Object(u["a"])([Object(d["g"])("teacherAnswerInfo")],ke.prototype,"handleTeacherAnswerInfoChange",null),Object(u["a"])([Object(d["b"])("sendMessage")],ke.prototype,"emitMessage",null),Object(u["a"])([Object(d["b"])("sendAnswer")],ke.prototype,"sendAnswer",null),ke=Object(u["a"])([Object(d["a"])({components:{ExpressPanel:he}})],ke);var Ie=ke,Se=Ie,Ce=(n("01cd"),Object(I["a"])(Se,ye,ge,!1,null,"60d6fda1",null)),Te=Ce.exports,Oe=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(o["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.containerHeight=969,e.hasNewQuestion=!1,e.selectedTabName="barrage",e}return Object(l["a"])(t,e),Object(r["a"])(t,[{key:"mounted",value:function(){this.containerHeight=window.innerHeight-document.getElementsByClassName("top")[0].clientHeight}},{key:"handleSwitchTabbar",value:function(e){this.selectedTabName=e,"studentQuestion"===e&&(this.hasNewQuestion=!1)}},{key:"handleStudentQuestionListChange",value:function(){"barrage"===this.selectedTabName&&(this.hasNewQuestion=!0)}}]),t}(Object(d["c"])(V));Object(u["a"])([Object(d["g"])("studentQuestionList")],Oe.prototype,"handleStudentQuestionListChange",null),Oe=Object(u["a"])([Object(d["a"])({filters:{speakTime:function(e){return P()(1e3*Number(e)).format("HH:mm")}},components:{Layout:E,OnlineUser:se,StudentQuestion:be,ChatRoom:Y,MessageInput:Te}})],Oe);var _e=Oe,je=_e,Le=(n("d497"),Object(I["a"])(je,s,a,!1,null,"fc71ec14",null));t["default"]=Le.exports},"783f":function(e,t,n){"use strict";var s=n("bbbb"),a=n.n(s);a.a},8600:function(e,t,n){},a434:function(e,t,n){"use strict";var s=n("23e7"),a=n("23cb"),i=n("a691"),r=n("50c4"),o=n("7b0b"),c=n("65f0"),l=n("8418"),u=n("1dde"),d=n("ae40"),h=u("splice"),p=d("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,v=Math.min,m=9007199254740991,b="Maximum allowed length exceeded";s({target:"Array",proto:!0,forced:!h||!p},{splice:function(e,t){var n,s,u,d,h,p,y=o(this),g=r(y.length),k=a(e,g),I=arguments.length;if(0===I?n=s=0:1===I?(n=0,s=g-k):(n=I-2,s=v(f(i(t),0),g-k)),g+n-s>m)throw TypeError(b);for(u=c(y,s),d=0;d<s;d++)h=k+d,h in y&&l(u,d,y[h]);if(u.length=s,n<s){for(d=k;d<g-s;d++)h=d+s,p=d+n,h in y?y[p]=y[h]:delete y[p];for(d=g;d>g-s+n;d--)delete y[d-1]}else if(n>s)for(d=g-s;d>k;d--)h=d+s-1,p=d+n-1,h in y?y[p]=y[h]:delete y[p];for(d=0;d<n;d++)y[d+k]=arguments[d+2];return y.length=g-s+n,u}})},a75f:function(e,t,n){},ab13:function(e,t,n){var s=n("b622"),a=s("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[a]=!1,"/./"[e](t)}catch(s){}}return!1}},afa0:function(e,t,n){},b2f1:function(e,t,n){},b772:function(e,t,n){"use strict";var s=n("b2f1"),a=n.n(s);a.a},bbbb:function(e,t,n){},caad:function(e,t,n){"use strict";var s=n("23e7"),a=n("4d64").includes,i=n("44d2"),r=n("ae40"),o=r("indexOf",{ACCESSORS:!0,1:0});s({target:"Array",proto:!0,forced:!o},{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),i("includes")},d497:function(e,t,n){"use strict";var s=n("a75f"),a=n.n(s);a.a},f1e5:function(e,t,n){},f641:function(e,t,n){},fe7c:function(e,t,n){"use strict";var s=n("afa0"),a=n.n(s);a.a}}]);
//# sourceMappingURL=assistant.6a7046bb.js.map